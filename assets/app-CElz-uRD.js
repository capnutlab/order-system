import{a as e,c as t,d as n,f as r,g as i,h as a,i as o,l as s,m as c,n as l,o as u,p as d,r as f,s as p,t as m,u as h}from"./jsx-runtime-D6M7Vawd.js";var g=c(),_=i(a(),1),v=m(),y={IN_PROGRESS:`進行中`,COMPLETED:`完了`},b={getDaysUntilDeadline:e=>{let t=new Date;t.setHours(0,0,0,0);let n=new Date(e);return n.setHours(0,0,0,0),Math.ceil((n-t)/(1e3*60*60*24))},getAlertLevel:e=>e<0?`overdue`:e<=3?`urgent`:e<=7?`warning`:`normal`},x={getRowColorClass:e=>{let t={overdue:`bg-red-50`,urgent:`bg-orange-50`,warning:`bg-yellow-50`,normal:`bg-white`};return t[e]||t.normal},getDaysTextColorClass:e=>e<0?`text-red-600`:e<=3?`text-orange-600`:e<=7?`text-yellow-600`:`text-slate-600`},S=({title:e,type:t,data:i,input:a,setInput:o,addFunc:s,moveUp:c,moveDown:u,deleteMaster:d})=>(0,v.jsxs)(`div`,{className:`bg-white border border-slate-200 p-5`,children:[(0,v.jsx)(`h3`,{className:`text-sm font-semibold text-slate-900 mb-4 tracking-wide uppercase`,children:e}),(0,v.jsxs)(`div`,{className:`flex gap-2 mb-4`,children:[(0,v.jsx)(`input`,{type:`text`,placeholder:`${e}を入力`,value:a,onChange:e=>o(e.target.value),onKeyPress:e=>e.key===`Enter`&&s(),className:`flex-1 px-3 py-2 text-sm border border-slate-300 focus:border-slate-900 focus:ring-1 focus:ring-slate-900 outline-none`}),(0,v.jsx)(`button`,{onClick:s,className:`px-4 py-2 bg-slate-900 text-white text-sm hover:bg-slate-800`,children:`追加`})]}),(0,v.jsx)(`div`,{className:`space-y-1 max-h-48 overflow-y-auto`,children:i.length===0?(0,v.jsx)(`div`,{className:`text-center py-6 text-slate-400`,children:(0,v.jsx)(`p`,{className:`text-xs`,children:`未登録`})}):i.map((e,a)=>(0,v.jsxs)(`div`,{className:`flex justify-between items-center bg-slate-50 px-3 py-2 hover:bg-slate-100 group`,children:[(0,v.jsx)(`span`,{className:`text-sm text-slate-700`,children:e}),(0,v.jsxs)(`div`,{className:`flex gap-1 opacity-0 group-hover:opacity-100`,children:[(0,v.jsx)(`button`,{onClick:()=>c(t,a),disabled:a===0,className:`p-1 ${a===0?`text-slate-300`:`text-slate-600 hover:text-slate-900`}`,children:(0,v.jsx)(n,{size:14})}),(0,v.jsx)(`button`,{onClick:()=>u(t,a),disabled:a===i.length-1,className:`p-1 ${a===i.length-1?`text-slate-300`:`text-slate-600 hover:text-slate-900`}`,children:(0,v.jsx)(r,{size:14})}),(0,v.jsx)(`button`,{onClick:()=>d(t,e),className:`p-1 text-slate-600 hover:text-red-600 ml-1`,children:(0,v.jsx)(l,{size:14})})]})]},a))}),(0,v.jsx)(`div`,{className:`mt-4 pt-4 border-t border-slate-200`,children:(0,v.jsxs)(`p`,{className:`text-xs text-slate-500 text-right`,children:[i.length,` 件`]})})]}),C=({commonData:e,setCommonData:t,items:n,setItems:r,masters:i,onSubmit:a,onCancel:o})=>{let[s,c]=(0,_.useState)(!1),[l,u]=(0,_.useState)([!1,!1,!1,!1,!1]),d=i.clients.filter(t=>!e.clientName||t.toLowerCase().includes(e.clientName.toLowerCase())),f=e=>{let t=n[e].size.toLowerCase();return i.products.filter(r=>!n[e].size||r.toLowerCase().includes(t))};return(0,v.jsxs)(`div`,{className:`bg-white border border-slate-200 p-6 mb-6`,children:[(0,v.jsx)(`h3`,{className:`text-sm font-semibold text-slate-900 mb-4 tracking-wide uppercase`,children:`新規注文（5件一括登録）`}),(0,v.jsxs)(`div`,{className:`mb-6 pb-6 border-b border-slate-200`,children:[(0,v.jsx)(`p`,{className:`text-xs text-slate-500 mb-3 uppercase tracking-wide`,children:`共通項目`}),(0,v.jsxs)(`div`,{className:`grid grid-cols-3 gap-4`,children:[(0,v.jsx)(`input`,{type:`text`,placeholder:`注文番号 *`,value:e.orderNumber,onChange:n=>t({...e,orderNumber:n.target.value}),className:`px-3 py-2 text-sm border border-slate-300 focus:border-slate-900 focus:ring-1 focus:ring-slate-900 outline-none`}),(0,v.jsxs)(`div`,{className:`relative`,children:[(0,v.jsx)(`input`,{type:`text`,placeholder:`顧客名`,value:e.clientName,onChange:n=>{t({...e,clientName:n.target.value}),c(!0)},onFocus:()=>c(!0),onBlur:()=>setTimeout(()=>c(!1),200),className:`px-3 py-2 text-sm border border-slate-300 focus:border-slate-900 focus:ring-1 focus:ring-slate-900 outline-none w-full`}),s&&d.length>0&&(0,v.jsx)(`div`,{className:`absolute z-20 w-full mt-1 bg-white border border-slate-300 rounded shadow-lg max-h-60 overflow-y-auto`,children:d.map((n,r)=>(0,v.jsx)(`div`,{onMouseDown:r=>{r.preventDefault(),t({...e,clientName:n}),c(!1)},className:`px-3 py-2 hover:bg-slate-100 cursor-pointer text-sm`,children:n},r))})]}),(0,v.jsx)(`input`,{type:`date`,value:e.deadline,onChange:n=>t({...e,deadline:n.target.value}),className:`px-3 py-2 text-sm border border-slate-300 focus:border-slate-900 focus:ring-1 focus:ring-slate-900 outline-none`})]})]}),(0,v.jsxs)(`div`,{className:`mb-6`,children:[(0,v.jsx)(`p`,{className:`text-xs text-slate-500 mb-3 uppercase tracking-wide`,children:`個別項目（材質・サイズ・数量）`}),(0,v.jsx)(`div`,{className:`space-y-3`,children:n.map((e,t)=>{let a=f(t);return(0,v.jsxs)(`div`,{className:`grid grid-cols-4 gap-4 items-center`,children:[(0,v.jsxs)(`span`,{className:`text-xs text-slate-500 font-medium`,children:[`#`,t+1]}),(0,v.jsxs)(`select`,{value:e.material,onChange:e=>{let i=[...n];i[t].material=e.target.value,r(i)},className:`px-3 py-2 text-sm border border-slate-300 focus:border-slate-900 focus:ring-1 focus:ring-slate-900 outline-none`,children:[(0,v.jsx)(`option`,{value:``,children:`材質`}),i.materials.map((e,t)=>(0,v.jsx)(`option`,{value:e,children:e},t))]}),(0,v.jsxs)(`div`,{className:`relative`,children:[(0,v.jsx)(`input`,{type:`text`,placeholder:`サイズ`,value:e.size,onChange:e=>{let i=[...n];i[t].size=e.target.value,r(i);let a=[...l];a[t]=!0,u(a)},onFocus:()=>{let e=[...l];e[t]=!0,u(e)},onBlur:()=>setTimeout(()=>{let e=[...l];e[t]=!1,u(e)},200),className:`px-3 py-2 text-sm border border-slate-300 focus:border-slate-900 focus:ring-1 focus:ring-slate-900 outline-none w-full`}),l[t]&&a.length>0&&(0,v.jsx)(`div`,{className:`absolute z-20 w-full mt-1 bg-white border border-slate-300 rounded shadow-lg max-h-60 overflow-y-auto`,children:a.map((e,i)=>(0,v.jsx)(`div`,{onMouseDown:i=>{i.preventDefault();let a=[...n];a[t].size=e,r(a);let o=[...l];o[t]=!1,u(o)},className:`px-3 py-2 hover:bg-slate-100 cursor-pointer text-sm`,children:e},i))})]}),(0,v.jsx)(`input`,{type:`number`,placeholder:`数量`,value:e.quantity,onChange:e=>{let i=[...n];i[t].quantity=e.target.value,r(i)},className:`px-3 py-2 text-sm border border-slate-300 focus:border-slate-900 focus:ring-1 focus:ring-slate-900 outline-none`})]},t)})})]}),(0,v.jsxs)(`div`,{className:`flex gap-3 mt-4`,children:[(0,v.jsx)(`button`,{onClick:a,className:`px-6 py-2 bg-slate-900 text-white text-sm hover:bg-slate-800`,children:`追加`}),(0,v.jsx)(`button`,{onClick:o,className:`px-6 py-2 border border-slate-300 text-slate-700 text-sm hover:bg-slate-50`,children:`キャンセル`})]})]})},w=({orders:e,onRowClick:n})=>e.length===0?(0,v.jsxs)(`div`,{className:`p-16 text-center`,children:[(0,v.jsx)(t,{size:48,className:`mx-auto mb-4 text-slate-300`}),(0,v.jsx)(`p`,{className:`text-slate-400 text-sm`,children:`注文データがありません`})]}):(0,v.jsxs)(`table`,{className:`w-full`,children:[(0,v.jsx)(`thead`,{className:`bg-slate-900 text-white`,children:(0,v.jsxs)(`tr`,{children:[(0,v.jsx)(`th`,{className:`px-4 py-3 text-left text-xs font-medium uppercase tracking-wider`,children:`注文番号`}),(0,v.jsx)(`th`,{className:`px-4 py-3 text-left text-xs font-medium uppercase tracking-wider`,children:`顧客名`}),(0,v.jsx)(`th`,{className:`px-4 py-3 text-left text-xs font-medium uppercase tracking-wider`,children:`商品名`}),(0,v.jsx)(`th`,{className:`px-4 py-3 text-left text-xs font-medium uppercase tracking-wider`,children:`材質`}),(0,v.jsx)(`th`,{className:`px-4 py-3 text-center text-xs font-medium uppercase tracking-wider`,children:`数量`}),(0,v.jsx)(`th`,{className:`px-4 py-3 text-left text-xs font-medium uppercase tracking-wider`,children:`納期`}),(0,v.jsx)(`th`,{className:`px-4 py-3 text-center text-xs font-medium uppercase tracking-wider`,children:`残日数`}),(0,v.jsx)(`th`,{className:`px-4 py-3 text-center text-xs font-medium uppercase tracking-wider`,children:`状態`}),(0,v.jsx)(`th`,{className:`px-4 py-3 text-center text-xs font-medium uppercase tracking-wider`,children:`詳細`})]})}),(0,v.jsx)(`tbody`,{className:`divide-y divide-slate-200`,children:e.sort((e,t)=>e.status===t.status?new Date(e.deadline)-new Date(t.deadline):e.status===y.COMPLETED?1:-1).map(e=>{let t=b.getDaysUntilDeadline(e.deadline),r=b.getAlertLevel(t),i=x.getRowColorClass(r),a=x.getDaysTextColorClass(t);return(0,v.jsxs)(`tr`,{className:`${i} cursor-pointer hover:bg-slate-100`,onClick:()=>n(e),children:[(0,v.jsx)(`td`,{className:`px-4 py-3 text-sm font-mono font-semibold text-slate-900`,children:e.orderNumber}),(0,v.jsx)(`td`,{className:`px-4 py-3 text-sm text-slate-700`,children:e.clientName||`−`}),(0,v.jsx)(`td`,{className:`px-4 py-3 text-sm text-slate-700`,children:e.productName||`−`}),(0,v.jsx)(`td`,{className:`px-4 py-3 text-sm text-slate-700`,children:e.material||`−`}),(0,v.jsx)(`td`,{className:`px-4 py-3 text-sm text-slate-700 text-center font-medium`,children:e.quantity||`−`}),(0,v.jsx)(`td`,{className:`px-4 py-3 text-sm text-slate-700 font-mono`,children:e.deadline}),(0,v.jsx)(`td`,{className:`px-4 py-3 text-center`,children:e.status!==y.COMPLETED&&(0,v.jsx)(`span`,{className:`text-xs font-semibold ${a}`,children:t<0?`${Math.abs(t)}日遅延`:`残り${t}日`})}),(0,v.jsx)(`td`,{className:`px-4 py-3 text-center`,children:(0,v.jsx)(`span`,{className:`px-3 py-1 text-xs font-medium ${e.status===y.COMPLETED?`bg-emerald-100 text-emerald-800`:`bg-slate-100 text-slate-800`}`,children:e.status})}),(0,v.jsx)(`td`,{className:`px-4 py-3 text-center`,children:(0,v.jsx)(`button`,{onClick:t=>{t.stopPropagation(),n(e)},className:`text-slate-400 hover:text-slate-900`,children:(0,v.jsx)(s,{size:16})})})]},e.id)})})]}),T=({order:e,masters:t,onClose:n,onStatusChange:r,onUpdate:i,onDelete:a})=>{let[s,c]=(0,_.useState)(!1),[u,f]=(0,_.useState)({...e}),m=b.getDaysUntilDeadline(u.deadline),g=x.getDaysTextColorClass(m);return(0,v.jsx)(`div`,{className:`fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center p-4 z-50`,onClick:n,children:(0,v.jsxs)(`div`,{className:`bg-white max-w-2xl w-full p-8 border border-slate-200`,onClick:e=>e.stopPropagation(),children:[(0,v.jsxs)(`div`,{className:`flex justify-between items-start mb-6`,children:[(0,v.jsx)(`h2`,{className:`text-lg font-semibold text-slate-900 tracking-wide uppercase`,children:s?`注文編集`:`注文詳細`}),(0,v.jsx)(`button`,{onClick:n,className:`text-slate-400 hover:text-slate-900`,children:(0,v.jsx)(l,{size:20})})]}),s?(0,v.jsxs)(`div`,{className:`space-y-4`,children:[(0,v.jsxs)(`div`,{className:`grid grid-cols-2 gap-4`,children:[(0,v.jsxs)(`div`,{children:[(0,v.jsx)(`label`,{className:`block text-xs text-slate-600 mb-2 uppercase tracking-wide`,children:`注文番号`}),(0,v.jsx)(`input`,{type:`text`,value:u.orderNumber,onChange:e=>f({...u,orderNumber:e.target.value}),className:`w-full px-3 py-2 text-sm border border-slate-300 focus:border-slate-900 focus:ring-1 focus:ring-slate-900 outline-none`})]}),(0,v.jsxs)(`div`,{children:[(0,v.jsx)(`label`,{className:`block text-xs text-slate-600 mb-2 uppercase tracking-wide`,children:`状態`}),(0,v.jsxs)(`select`,{value:u.status,onChange:e=>f({...u,status:e.target.value}),className:`w-full px-3 py-2 text-sm border border-slate-300 focus:border-slate-900 focus:ring-1 focus:ring-slate-900 outline-none`,children:[(0,v.jsx)(`option`,{value:y.IN_PROGRESS,children:y.IN_PROGRESS}),(0,v.jsx)(`option`,{value:y.COMPLETED,children:y.COMPLETED})]})]})]}),(0,v.jsxs)(`div`,{className:`grid grid-cols-2 gap-4`,children:[(0,v.jsxs)(`div`,{children:[(0,v.jsx)(`label`,{className:`block text-xs text-slate-600 mb-2 uppercase tracking-wide`,children:`顧客名`}),(0,v.jsx)(`input`,{type:`text`,list:`edit-client-list`,value:u.clientName,onChange:e=>f({...u,clientName:e.target.value}),className:`w-full px-3 py-2 text-sm border border-slate-300 focus:border-slate-900 focus:ring-1 focus:ring-slate-900 outline-none`}),(0,v.jsx)(`datalist`,{id:`edit-client-list`,children:t.clients.map((e,t)=>(0,v.jsx)(`option`,{value:e},t))})]}),(0,v.jsxs)(`div`,{children:[(0,v.jsx)(`label`,{className:`block text-xs text-slate-600 mb-2 uppercase tracking-wide`,children:`商品名`}),(0,v.jsx)(`input`,{type:`text`,list:`edit-product-list`,value:u.productName,onChange:e=>f({...u,productName:e.target.value}),className:`w-full px-3 py-2 text-sm border border-slate-300 focus:border-slate-900 focus:ring-1 focus:ring-slate-900 outline-none`}),(0,v.jsx)(`datalist`,{id:`edit-product-list`,children:t.products.map((e,t)=>(0,v.jsx)(`option`,{value:e},t))})]})]}),(0,v.jsxs)(`div`,{className:`grid grid-cols-2 gap-4`,children:[(0,v.jsxs)(`div`,{children:[(0,v.jsx)(`label`,{className:`block text-xs text-slate-600 mb-2 uppercase tracking-wide`,children:`材質`}),(0,v.jsxs)(`select`,{value:u.material,onChange:e=>f({...u,material:e.target.value}),className:`w-full px-3 py-2 text-sm border border-slate-300 focus:border-slate-900 focus:ring-1 focus:ring-slate-900 outline-none`,children:[(0,v.jsx)(`option`,{value:``,children:`材質を選択`}),t.materials.map((e,t)=>(0,v.jsx)(`option`,{value:e,children:e},t))]})]}),(0,v.jsxs)(`div`,{children:[(0,v.jsx)(`label`,{className:`block text-xs text-slate-600 mb-2 uppercase tracking-wide`,children:`数量`}),(0,v.jsx)(`input`,{type:`number`,value:u.quantity,onChange:e=>f({...u,quantity:e.target.value}),className:`w-full px-3 py-2 text-sm border border-slate-300 focus:border-slate-900 focus:ring-1 focus:ring-slate-900 outline-none`})]})]}),(0,v.jsxs)(`div`,{children:[(0,v.jsx)(`label`,{className:`block text-xs text-slate-600 mb-2 uppercase tracking-wide`,children:`納期`}),(0,v.jsx)(`input`,{type:`date`,value:u.deadline,onChange:e=>f({...u,deadline:e.target.value}),className:`w-full px-3 py-2 text-sm border border-slate-300 focus:border-slate-900 focus:ring-1 focus:ring-slate-900 outline-none`})]})]}):(0,v.jsxs)(`div`,{className:`space-y-6`,children:[(0,v.jsxs)(`div`,{className:`grid grid-cols-2 gap-6`,children:[(0,v.jsxs)(`div`,{children:[(0,v.jsx)(`p`,{className:`text-xs text-slate-500 uppercase tracking-wide mb-1`,children:`注文番号`}),(0,v.jsx)(`p`,{className:`text-lg font-semibold font-mono text-slate-900`,children:u.orderNumber})]}),(0,v.jsxs)(`div`,{children:[(0,v.jsx)(`p`,{className:`text-xs text-slate-500 uppercase tracking-wide mb-1`,children:`状態`}),(0,v.jsx)(`span`,{className:`inline-block px-3 py-1 text-xs font-medium ${u.status===y.COMPLETED?`bg-emerald-100 text-emerald-800`:`bg-slate-100 text-slate-800`}`,children:u.status})]})]}),(0,v.jsxs)(`div`,{className:`grid grid-cols-2 gap-6`,children:[(0,v.jsxs)(`div`,{children:[(0,v.jsx)(`p`,{className:`text-xs text-slate-500 uppercase tracking-wide mb-1`,children:`顧客名`}),(0,v.jsx)(`p`,{className:`text-sm text-slate-900`,children:u.clientName||`−`})]}),(0,v.jsxs)(`div`,{children:[(0,v.jsx)(`p`,{className:`text-xs text-slate-500 uppercase tracking-wide mb-1`,children:`商品名`}),(0,v.jsx)(`p`,{className:`text-sm text-slate-900`,children:u.productName||`−`})]})]}),(0,v.jsxs)(`div`,{className:`grid grid-cols-2 gap-6`,children:[(0,v.jsxs)(`div`,{children:[(0,v.jsx)(`p`,{className:`text-xs text-slate-500 uppercase tracking-wide mb-1`,children:`材質`}),(0,v.jsx)(`p`,{className:`text-sm text-slate-900`,children:u.material||`−`})]}),(0,v.jsxs)(`div`,{children:[(0,v.jsx)(`p`,{className:`text-xs text-slate-500 uppercase tracking-wide mb-1`,children:`数量`}),(0,v.jsx)(`p`,{className:`text-sm text-slate-900`,children:u.quantity||`−`})]})]}),(0,v.jsxs)(`div`,{className:`pt-4 border-t border-slate-200`,children:[(0,v.jsx)(`p`,{className:`text-xs text-slate-500 uppercase tracking-wide mb-2`,children:`納期`}),(0,v.jsxs)(`div`,{className:`flex items-baseline gap-4`,children:[(0,v.jsx)(`p`,{className:`text-lg font-mono font-semibold text-slate-900`,children:u.deadline}),u.status!==y.COMPLETED&&(0,v.jsx)(`span`,{className:`text-sm font-semibold ${g}`,children:m<0?`${Math.abs(m)}日遅延`:`残り${m}日`})]})]})]}),(0,v.jsx)(`div`,{className:`flex flex-col gap-3 mt-8 pt-6 border-t border-slate-200`,children:s?(0,v.jsx)(v.Fragment,{children:(0,v.jsxs)(`div`,{className:`flex gap-3`,children:[(0,v.jsxs)(`button`,{onClick:()=>{i(u),c(!1)},className:`flex-1 px-6 py-3 bg-slate-900 text-white text-sm hover:bg-slate-800 flex items-center justify-center gap-2`,children:[(0,v.jsx)(h,{size:16}),`保存`]}),(0,v.jsxs)(`button`,{onClick:()=>{f({...e}),c(!1)},className:`flex-1 px-6 py-3 border border-slate-300 text-slate-700 text-sm hover:bg-slate-50 flex items-center justify-center gap-2`,children:[(0,v.jsx)(l,{size:16}),`キャンセル`]})]})}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)(`div`,{className:`flex gap-3`,children:[(0,v.jsxs)(`button`,{onClick:()=>c(!0),className:`flex-1 px-6 py-3 bg-slate-900 text-white text-sm hover:bg-slate-800 flex items-center justify-center gap-2`,children:[(0,v.jsx)(p,{size:16}),`編集`]}),u.status===y.COMPLETED?(0,v.jsxs)(`button`,{onClick:()=>{r(u.id,y.IN_PROGRESS),f({...u,status:y.IN_PROGRESS})},className:`flex-1 px-6 py-3 border border-slate-300 text-slate-700 text-sm hover:bg-slate-50 flex items-center justify-center gap-2`,children:[(0,v.jsx)(d,{size:16}),`進行中に戻す`]}):(0,v.jsxs)(`button`,{onClick:()=>{r(u.id,y.COMPLETED),f({...u,status:y.COMPLETED})},className:`flex-1 px-6 py-3 border border-slate-300 text-slate-700 text-sm hover:bg-slate-50 flex items-center justify-center gap-2`,children:[(0,v.jsx)(h,{size:16}),`完了`]})]}),(0,v.jsxs)(`button`,{onClick:()=>{window.confirm(`この注文を削除してもよろしいですか？`)&&a(u.id)},className:`w-full px-6 py-3 bg-red-600 text-white text-sm hover:bg-red-700 flex items-center justify-center gap-2`,children:[(0,v.jsx)(o,{size:16}),`削除`]})]})})]})})};(0,g.createRoot)(document.getElementById(`root`)).render((0,v.jsx)(_.StrictMode,{children:(0,v.jsx)(()=>{let[t,n]=(0,_.useState)([]),[r,i]=(0,_.useState)(!1),[a,o]=(0,_.useState)(null),[s,c]=(0,_.useState)(`orders`),[l,d]=(0,_.useState)({clients:[],products:[],materials:[]}),[p,m]=(0,_.useState)(``),[h,g]=(0,_.useState)(``),[x,E]=(0,_.useState)(``),[D,O]=(0,_.useState)({orderNumber:``,clientName:``,deadline:``}),[k,A]=(0,_.useState)([{material:``,size:``,quantity:``},{material:``,size:``,quantity:``},{material:``,size:``,quantity:``},{material:``,size:``,quantity:``},{material:``,size:``,quantity:``}]),j=`http://${window.location.hostname}:3001/api`;(0,_.useEffect)(()=>{(async()=>{try{n(await(await fetch(`${j}/orders`)).json()||[]),d(await(await fetch(`${j}/masters`)).json()||{clients:[],products:[],materials:[]})}catch(e){console.error(`初回読み込みエラー:`,e)}})()},[]);let M=async e=>{try{await fetch(`${j}/masters`,{method:`POST`,headers:{"Content-Type":`application/json`},body:JSON.stringify(e)})}catch(e){console.error(`マスタ保存エラー:`,e)}},N=async e=>{try{await fetch(`${j}/orders`,{method:`POST`,headers:{"Content-Type":`application/json`},body:JSON.stringify(e)})}catch(e){console.error(`注文保存エラー:`,e)}},P=async()=>{try{n(await(await fetch(`${j}/orders`)).json()||[]),alert(`最新データをサーバーから取得しました`)}catch(e){console.error(`更新失敗:`,e),alert(`データの更新に失敗しました。サーバーが動いているか確認してください。`)}},F=async()=>{let e=p.trim();if(!e)return;if(l.clients.includes(e)){alert(`既に登録されています`),m(``);return}let t={...l,clients:[...l.clients,e]};d(t),await M(t),m(``)},I=async()=>{let e=h.trim();if(!e)return;if(l.products.includes(e)){alert(`既に登録されています`),g(``);return}let t={...l,products:[...l.products,e]};d(t),await M(t),g(``)},L=async()=>{let e=x.trim();if(!e)return;if(l.materials.includes(e)){alert(`既に登録されています`),E(``);return}let t={...l,materials:[...l.materials,e]};d(t),await M(t),E(``)},R=async(e,t)=>{if(t===0)return;let n=[...l[e]];[n[t-1],n[t]]=[n[t],n[t-1]];let r={...l,[e]:n};d(r),await M(r)},z=async(e,t)=>{if(t===l[e].length-1)return;let n=[...l[e]];[n[t],n[t+1]]=[n[t+1],n[t]];let r={...l,[e]:n};d(r),await M(r)},B=async(e,t)=>{let n={...l,[e]:l[e].filter(e=>e!==t)};d(n),await M(n)},V=async()=>{if(!D.orderNumber||!D.deadline){alert(`注文番号と納期は必須です`);return}let e=k.filter(e=>e.material||e.size||e.quantity);if(e.length===0){alert(`少なくとも1件の材質・サイズ・数量を入力してください`);return}let r=e.map((e,t)=>({orderNumber:D.orderNumber,clientName:D.clientName,productName:``,material:e.material,size:e.size,quantity:e.quantity,deadline:D.deadline,status:y.IN_PROGRESS,id:Date.now()+t,uploadedAt:new Date().toISOString()}));for(let e of r)await N(e);n([...t,...r]),O({orderNumber:``,clientName:``,deadline:``}),A([{material:``,size:``,quantity:``},{material:``,size:``,quantity:``},{material:``,size:``,quantity:``},{material:``,size:``,quantity:``},{material:``,size:``,quantity:``}]),i(!1),alert(`${r.length}件の注文を追加しました`)},H=async(e,r)=>{n(t.map(t=>{if(t.id===e){let e={...t,status:r,completedAt:r===y.COMPLETED?new Date().toISOString():null};return N(e),e}return t}))},U=async e=>{await N(e),n(t.map(t=>t.id===e.id?e:t)),alert(`注文を更新しました`),o(null)},W=async e=>{try{if(!(await fetch(`${j}/orders/${e}`,{method:`DELETE`})).ok)throw Error(`削除に失敗しました`);n(t.filter(t=>t.id!==e)),o(null),alert(`注文を削除しました`)}catch(e){console.error(`削除エラー:`,e),alert(`注文の削除に失敗しました`)}},G=t.filter(e=>e.status===y.COMPLETED?!1:b.getDaysUntilDeadline(e.deadline)<=7);return(0,v.jsx)(`div`,{className:`min-h-screen bg-slate-50 p-6`,children:(0,v.jsxs)(`div`,{className:`max-w-full mx-auto`,children:[(0,v.jsxs)(`div`,{className:`bg-white border border-slate-200 mb-6`,children:[(0,v.jsxs)(`div`,{className:`flex justify-between items-center p-6 border-b border-slate-200`,children:[(0,v.jsxs)(`div`,{children:[(0,v.jsx)(`h1`,{className:`text-2xl font-semibold text-slate-900 tracking-tight`,children:`注文書納期管理`}),(0,v.jsx)(`p`,{className:`text-sm text-slate-500 mt-1`,children:`Order Deadline Management System`})]}),(0,v.jsxs)(`button`,{onClick:P,className:`px-4 py-2 border border-slate-300 text-slate-700 text-sm hover:bg-slate-50 flex items-center gap-2`,children:[(0,v.jsx)(e,{size:16}),`更新`]})]}),(0,v.jsxs)(`div`,{className:`flex border-b border-slate-200`,children:[(0,v.jsx)(`button`,{onClick:()=>c(`orders`),className:`px-6 py-3 text-sm font-medium ${s===`orders`?`text-slate-900 border-b-2 border-slate-900`:`text-slate-500 hover:text-slate-700`}`,children:`注文管理`}),(0,v.jsx)(`button`,{onClick:()=>c(`masters`),className:`px-6 py-3 text-sm font-medium ${s===`masters`?`text-slate-900 border-b-2 border-slate-900`:`text-slate-500 hover:text-slate-700`}`,children:`マスタ登録`})]}),(0,v.jsx)(`div`,{className:`p-6`,children:s===`masters`?(0,v.jsxs)(`div`,{children:[(0,v.jsx)(`div`,{className:`bg-slate-100 border-l-2 border-slate-900 p-4 mb-6`,children:(0,v.jsx)(`p`,{className:`text-sm text-slate-700`,children:`よく使う顧客名・商品名・材質を事前に登録しておくと、注文追加時に選択できます`})}),(0,v.jsxs)(`div`,{className:`grid grid-cols-1 lg:grid-cols-3 gap-6`,children:[(0,v.jsx)(S,{title:`顧客名`,type:`clients`,data:l.clients,input:p,setInput:m,addFunc:F,moveUp:R,moveDown:z,deleteMaster:B}),(0,v.jsx)(S,{title:`商品名`,type:`products`,data:l.products,input:h,setInput:g,addFunc:I,moveUp:R,moveDown:z,deleteMaster:B}),(0,v.jsx)(S,{title:`材質`,type:`materials`,data:l.materials,input:x,setInput:E,addFunc:L,moveUp:R,moveDown:z,deleteMaster:B})]})]}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)(`button`,{onClick:()=>i(!r),className:`mb-6 px-4 py-2 bg-slate-900 text-white text-sm hover:bg-slate-800 flex items-center gap-2`,children:[(0,v.jsx)(u,{size:16}),`新規注文`]}),r&&(0,v.jsx)(C,{commonData:D,setCommonData:O,items:k,setItems:A,masters:l,onSubmit:V,onCancel:()=>i(!1)}),G.length>0&&(0,v.jsx)(`div`,{className:`mb-6 bg-red-50 border-l-2 border-red-600 p-4`,children:(0,v.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,v.jsx)(f,{className:`text-red-600`,size:20}),(0,v.jsxs)(`p`,{className:`text-sm text-red-800 font-medium`,children:[G.length,`件の注文が納期7日以内です`]})]})})]})})]}),s===`orders`&&(0,v.jsx)(`div`,{className:`bg-white border border-slate-200 overflow-hidden`,children:(0,v.jsx)(w,{orders:t,onRowClick:o})}),a&&(0,v.jsx)(T,{order:a,masters:l,onClose:()=>o(null),onStatusChange:H,onUpdate:U,onDelete:W})]})})},{})}));